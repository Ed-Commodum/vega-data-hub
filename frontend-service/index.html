<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js" charset="utf-8"></script>
</head>
<body>
    <div id="test"></div>
    <script>
        const test = document.getElementById('test');
        const apiAddr = 'http://65.108.62.30:8080'
        const data = {};
        let decimals;
        const getDecimals = async () => {
            const res = await fetch(`${apiAddr}/decimals`);
            const json = await res.json();
            console.log(json);
            const decimals = {};
            for (let market of json.decimals) decimals[market.marketId] = market;
            return decimals;
        };
        (async () => { decimals = await getDecimals() })();

        const getXData = async () => {
            const res = await fetch(`${apiAddr}/historical-volume`);
            const json = await res.json();           

            console.log(json);

            for (let market of json.volumes) {
                data[market.marketId] = {
                    name: decimals[market.marketId].instrumentCode,
                    type: 'bar',
                    x: market.data.map((elem) => elem.timeBucket),
                    y: market.data.map((elem) => (BigInt(elem.volume) / 10n**(BigInt(decimals[market.marketId].priceDecimals) + BigInt(decimals[market.marketId].positionDecimals))).toString())
                };
            }

            console.log(data);

            const layout = { barmode: 'stack' };

            Plotly.newPlot( test, Object.values(data), layout );

            return [];
        };

        getXData();

        // Plotly.newPlot( test, [{
        // x: [1, 2, 3, 4, 5],
        // y: [1, 2, 4, 8, 16] }], {
        // margin: { t: 0 } } );
    </script>
</body>
</html>