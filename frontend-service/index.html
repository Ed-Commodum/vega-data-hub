<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js" charset="utf-8"></script>
</head>
<body>
    <div id="test-0"></div>
    <div id="test-1"></div>
    <div id="test-2"></div>
    <div id="test-3"></div>
    <div id="test-4"></div>
    <div id="test-5"></div>
    <script>

        const elementIds = [ "test-0", "test-1", "test-2", "test-3", "test-4", "test-5" ]
        const apiAddr = 'http://65.108.62.30:8080';


        let div = document.getElementById('test-0');
        let decimals;
        const getDecimals = async () => {
            const res = await fetch(`${apiAddr}/decimals`);
            const json = await res.json();
            console.log(json);
            const decimals = {};
            for (let market of json.decimals) decimals[market.marketId] = market;
            return decimals;
        };
        (async () => { decimals = await getDecimals() })();

        const getHistoricalVolumeData = async () => {
            const res = await fetch(`${apiAddr}/historical-volume`);
            const json = await res.json();           

            console.log(json);

            const data = {};
            for (let market of json.volumes) {
                data[market.marketId] = {
                    name: decimals[market.marketId].instrumentCode,
                    type: 'bar',
                    x: market.data.map((elem) => elem.timeBucket),
                    y: market.data.map((elem) => (BigInt(elem.volume) / 10n**(BigInt(decimals[market.marketId].priceDecimals) + BigInt(decimals[market.marketId].positionDecimals))).toString())
                };
            }

            console.log(data);

            const layout = { barmode: 'stack' };

            Plotly.newPlot( div, Object.values(data), layout );

            return [];
        };

        getHistoricalVolumeData();

        div = document.getElementById('test-1');
        
        const getHistoricalOpenInterestData = async () => {
            const res = await fetch(`${apiAddr}/historical-open-interest`);
            const json = await res.json();

            console.log(json);

            for (let item of json.openInterests) {

            }
            
        }

        const getHistoricalUniqueDepositors = () => {
            
        }

        const getHistoricalUniqueTraders = () => {
            
        }

        const getRewardsByMarket = () => {

        }

        const getRewardsTopEarners = () => {

        }

        const getHistoricalTradesData = () => {
            
        }

        // Plotly.newPlot( test, [{
        // x: [1, 2, 3, 4, 5],
        // y: [1, 2, 4, 8, 16] }], {
        // margin: { t: 0 } } );
    </script>
</body>
</html>